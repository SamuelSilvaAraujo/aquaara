{% extends 'menu.html' %}
{% load static %}

{% block title %}{{ pond.identification }}{% endblock %}

{% block head %}
    <link href="{% static 'css/plugins/footable/footable.core.css' %}" rel="stylesheet">
{% endblock %}

{% block header %}
    <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <div class="col-md-12">
                <h2>{{ pond.identification }}</h2>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{% url 'property_ponds' property.id %}">{{ property.name }}</a>
                    </li>
                    <li class="breadcrumb-item active">
                        <strong>{{ pond.identification }}</strong>
                    </li>
                </ol>
            </div>
        </div>
        <ul class="nav navbar-top-links navbar-right">
            <li>
                {% if not pond.cycle %}
                    <a href="{% url 'cycle_init' property.id pond.id %}" style="color: #ec971f">Novo Ciclo</a>
                {% else %}
                    {% if not pond.cycle.population %}

                        <a href="{% url 'population' property.id pond.id %}" style="color: #ec971f">Povoamento</a>

                    {% else %}

                        <a href="{% url 'despesca' property.id pond.id %}" style="color: #ec971f">Despesca</a>

                    {% endif %}

                {% endif %}
            </li>
            <li>
                <a href="#" style="color: #23c6c8">Ciclos antigos</a>
            </li>
            <li>
                <a href="{% url 'pond_update' property.id pond.id %}" style="color: #398439">Editar</a>
            </li>
            <li>
                <a href="{% url 'pond_delete' property.id pond.id %}" style="color: #c9302c">Excluir</a>
            </li>
        </ul>

    </nav>
{% endblock %}

{% block content %}

    <div class="row">
        <div class="col-lg-3 col-md-6 col-xs-6">
            <div class="ibox ">
                <div class="ibox-content">
                    <h5>Ciclos Realizados</h5>
                    <h2 class="no-margins">{{ pond.number_cycles }}</h2>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 col-xs-6">
            <div class="ibox">
                <div class="ibox-content">
                    <h5>Vazão de Água</h5>
                    <h2 class="no-margins">{{ pond.water_flow }} L/s</h2>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 col-xs-6">

            <div class="ibox ">
                <div class="ibox-content">
                    <h5>Área do viveiro</h5>
                    <h2 class="no-margins">{{ pond.area }} m²</h2>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 col-xs-6">
            <div class="ibox ">
                <div class="ibox-content">
                    <h5>Volume de Água</h5>
                    <h2 class="no-margins">{{ pond.volume }} L</h2>
                </div>
            </div>
        </div>
    </div>

    {% if pond.cycle %}

        <div class="row">
            <div class="col-lg-4">
                <div class="ibox">
                    <div class="ibox-content">
                        <h5>Densidade</h5>
                        <h2>{{ pond.cycle.density }} peixe/m²</h2>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="ibox">
                    <div class="ibox-content">
                        <h5>Quantidade de Peixes</h5>
                        <h2>{{ pond.cycle.amount_fish }} peixes</h2>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="ibox">
                    <div class="ibox-content">
                        <h5>Sistema</h5>
                        <h2>{{ pond.cycle.get_system_display }} </h2>
                        {% if pond.cycle.system == 'IN' %}
                            <small class="m-r">{{ pond.cycle.get_type_intensive_display }}</small>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        {% if pond.cycle.population %}

            <div class="row">
                <div class="col-lg-6">
                    <div class="ibox">
                        <div class="ibox-title">
                            <h5>Arraçoamento</h5>
                        </div>
                        <div class="ibox-content">
                            <div class="row">
                                <div class="col-md-6">
                                    <h3>Quantidade de ração:</h3>
                                    <h2>{{ pond.cycle.arracoamento|floatformat:2 }} g</h2>
                                </div>
                                <div class="col-md-6">
                                    <h3>Numero de refeições por dia:</h3>
                                    <h2>{{ pond.cycle.number_refeicoes }}</h2>
                                </div>
                            </div>

                        </div>
                        <div class="ibox-content">
                            <div class="row">
                                <div class="col-md-6">
                                    <h3>Proteina na ração:</h3>
                                    <h2>{{ pond.cycle.proteina_racao }} %</h2>
                                </div>
                                <div class="col-md-6">

                                </div>
                            </div>

                        </div>
                        <div class="ibox-content">
                            <h3>Diametro do pelete:</h3>
                            <h2>{{ pond.cycle.diametro_pelete }} mm</h2>
                        </div>
                        <div class="ibox-content">
                            <h3>Horarios da ração:</h3>
                            <h2>{{ pond.cycle.horario_refeicoes }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="ibox">
                        <div class="ibox-title">
                            <h5>Biometria</h5>
                            <div class="pull-right">
                                <a href="{% url 'biometria' property.id pond.id %}" class="btn btn-warning btn-outline btn-xs">Nova Biometria</a>
                                {% if pond.cycle.all_biometria.count > 0 %}
                                    <a href="#" class="btn btn-success btn-outline btn-xs" data-toggle="modal" data-target="#allBiometriaModal">Todas as Biometrias</a>
                                {% endif %}
                            </div>
                        </div>

                        {% if pond.cycle.all_biometria.count > 0 %}

                            <div class="ibox-content">

                                <h5>Última Biometria realizada</h5>

                                <div class="row">
                                    <div class="col-md-6">
                                        <h4>Data</h4>
                                        <h5>{{ pond.cycle.last_biometria.date }}</h5>
                                    </div>
                                    <div class="col-md-6">
                                        <h4>Peso Médio</h4>
                                        <h5>{{ pond.cycle.last_biometria.middleweight }} g</h5>
                                    </div>
                                </div>

                            </div>

                        {% endif %}

                        <div class="ibox-content">

                            <h5>Próxima Biometria</h5>

                            <div class="row">
                                <div class="col-md-6">
                                    <h4>Data</h4>
                                    <h5>{{ pond.cycle.date_biometria }}</h5>
                                </div>
                                <div class="col-md-6">
                                    <h4>Total de peixes</h4>
                                    <h5>{{ pond.cycle.amount_fish_biometria }} peixes</h5>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal inmodal" id="allBiometriaModal" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content animated bounceInRight">
                                <div class="modal-header">
                                    <h4 class="modal-title">Biometrias</h4>
                                </div>
                                <div class="modal-body">
                                    <table class="footableB table table-stripped toggle-arrow-tiny" data-page-size="5">
                                        <thead>
                                        <tr>
                                            <th>Data</th>
                                            <th>Peso medio</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for bio in pond.cycle.all_biometria %}
                                            <tr>
                                                <td>{{ bio.date }}</td>
                                                <td>{{ bio.middleweight }} kg</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <td colspan="5">
                                                <ul class="pagination pull-right"></ul>
                                            </td>
                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-white" data-dismiss="modal">Fechar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="ibox">
                        <div class="ibox-title">
                            <h5>Mortalidade</h5>
                            <div class="pull-right">
                                <a href="{% url 'mortality' property.id pond.id %}" class="btn btn-info btn-outline btn-xs">Novo registro</a>

                                {% if pond.cycle.all_mortality.count > 0 %}
                                    <a href="#" class="btn btn-success btn-outline btn-xs" data-toggle="modal" data-target="#allMortalidadeModal">Todos os registro</a>
                                {% endif %}
                            </div>
                        </div>
                        <div class="ibox-content">
                            {% if pond.cycle.all_mortality.count > 0 %}

                                <h1>{{ pond.cycle.total_mortality }}</h1>
                                <h3>Peixes Mortos</h3>

                            {% else %}

                                <h4>Nenhuma Mortalidade registrada</h4>

                            {% endif %}
                        </div>
                    </div>

                    <div class="modal inmodal" id="allMortalidadeModal" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content animated bounceInRight">
                                <div class="modal-header">
                                    <h4 class="modal-title">Mortalidade</h4>
                                </div>
                                <div class="modal-body">
                                    <table class="footableM table table-stripped toggle-arrow-tiny" data-page-size="5">
                                        <thead>
                                        <tr>
                                            <th>Data</th>
                                            <th>Quantidade de peixes</th>
                                        </tr>
                                        </thead>
                                        <tbody>

                                        {% for mortalidade in pond.cycle.all_mortality %}
                                            <tr>
                                                <td>{{ mortalidade.date }}</td>
                                                <td>{{ mortalidade.amount }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <td colspan="5">
                                                <ul class="pagination pull-right"></ul>
                                            </td>
                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-white" data-dismiss="modal">Fechar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div class="row">
                <div class="col-lg-4">
                    <div class="ibox">
                        <div class="ibox-title">
                            <h5>Povoamento</h5>
                        </div>
                        <div class="ibox-content">
                            <h3>Data</h3>
                            <h2>{{ pond.cycle.population.date }}</h2>
                        </div>
                        <div class="ibox-content">
                            <h3>Peso Médio</h3>
                            <h2>{{ pond.cycle.population.middleweight }} g</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="ibox">
                        <div class="ibox-title">
                            <h5>Despesca</h5>
                        </div>
                        <div class="ibox-content">
                            <h3>Data Prevista</h3>
                            <h2>{{ pond.cycle.date_despesca }}</h2>
                        </div>
                        <div class="ibox-content">
                            <h3>Peso Médio esperado</h3>
                            <h2> {{ pond.cycle.middleweight_despesca }} kg</h2>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="ibox">
                        <div class="ibox-title">
                            <h5>Biomassa</h5>
                        </div>
                        <div class="ibox-content">
                            <h3>{{ pond.cycle.biomassa|floatformat:2 }} kg</h3>
                        </div>
                    </div>
                    <div class="ibox">
                        <div class="ibox-title">
                            <h5>Peso Medio atual</h5>
                        </div>
                        <div class="ibox-content">
                            <h3>{{ pond.cycle.peso_medio }} kg</h3>
                        </div>
                    </div>
                </div>
            </div>

        {% endif %}

    {% endif %}

{% endblock %}

{% block script %}

    <script src="{% static 'js/plugins/footable/footable.all.min.js' %}"></script>

    <script>
        $(document).ready(function() {

            $('.footableB').footable();
            $('.footableM').footable();
            $('.footableC').footable();

        });

    </script>

{% endblock %}