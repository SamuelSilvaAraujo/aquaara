{% extends 'pond_base.html' %}
{% load static %}

{% block head %}
    <link href="{% static 'css/plugins/footable/footable.core.css' %}" rel="stylesheet">

    <link href="{% static 'css/plugins/morris/morris-0.4.3.min.css' %}" rel="stylesheet">

{% endblock %}

{% block content %}

    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-content p-md">
                    <div class="row">
                        <div class="col-md-6">
                            <h2><span class="text-navy">{{ pond.identification }}</span></h2>
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item">
                                    <a href="{% url 'property_ponds' property.id %}">{{ property.name }}</a>
                                </li>
                                <li class="breadcrumb-item active">
                                    <strong>{{ pond.identification }}</strong>
                                </li>
                            </ol>
                        </div>
                        <div class="col-md-6">
                            <div class="pull-right">
                                {% if not pond.cycle %}
                                    <a href="{% url 'cycle_init' property.id pond.id %}"  class="btn btn-warning btn-outline btn-link"><strong>Novo ciclo</strong></a>
                                {% else %}
                                    {% if not pond.cycle.population %}
                                        <a href="{% url 'population' property.id pond.id %}"  class="btn btn-warning btn-outline btn-link"><strong>Povoamento</strong></a>
                                    {% else %}
                                        <a href="{% url 'despesca' property.id pond.id %}" class="btn btn-warning btn-outline btn-link"><strong>Despesca</strong></a>
                                    {% endif %}
                                {% endif %}
                                <a href="#" class="btn btn-primary btn-outline btn-link">
                                    Ciclos antigos
                                </a>
                                <a href="{% url 'pond_update' property.id pond.id %}" class="btn btn-success btn-outline btn-link">
                                    Editar
                                </a>
                                <a href="{% url 'pond_delete' property.id pond.id %}" class="btn btn-danger btn-outline btn-link">
                                    Excluir
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-6">
            <div class="ibox">
                <div class="ibox-content">
                    <h2>
                        Ciclos realizados:
                        <small> {{ pond.number_cycles }}</small>
                    </h2>
                    <h2>
                        Área do viveiro:
                        <small> {{ pond.area }} m²</small>
                    </h2>
                    <h2>
                        Vazão de Água:
                        <small> {{ pond.water_flow }} l/s</small>
                    </h2>
                    <h2>
                        Volume de Água:
                        <small> {{ pond.volume }} L</small>
                    </h2>
                </div>
            </div>
        </div>

        {% if pond.cycle %}
            <div class="col-lg-6">
                <div class="ibox">
                    <div class="ibox-content">
                        <h2>Sistema:
                            <small> {{ pond.cycle.get_system_display }}
                                {% if pond.cycle.system == 'IN' %}
                                    <h5>{{ pond.cycle.get_type_intensive_display }}</h5>
                                {% endif %}
                            </small>
                        </h2>
                        <h2>
                            Densidade:
                            <small> {{ pond.cycle.density }} peixe/m²</small>
                        </h2>
                        <h2>
                            Quantidade de Peixes:
                            <small>{{ pond.cycle.amount_fish }} peixes</small>
                        </h2>

                    </div>
                </div>
            </div>
        {% endif %}
    </div>

    {% if pond.cycle and pond.cycle.population %}

        <div class="row">
            <div class="col-lg-6">

                <div class="ibox ">
                    <div class="ibox-title">
                        <h3>Arraçoamento</h3>
                    </div>
                    <div class="ibox-content">
                        <h2>Quantidade de ração:
                            <small>{{ pond.cycle.arracoamento|floatformat:2 }} g</small>
                        </h2>

                        <h2>
                            Refeições por dia:
                            <small>{{ pond.cycle.number_refeicoes }}</small>
                        </h2>
                        <h2>
                            Horários da ração:
                            <small>{{ pond.cycle.horario_refeicoes }}</small>
                        </h2>
                        <h2>
                            Proteina na ração:
                            <small>{{ pond.cycle.proteina_racao }} %</small>
                        </h2>
                        <h2>
                            Diâmetro do pelete:
                            <small>{{ pond.cycle.diametro_pelete }} mm</small>
                        </h2>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="ibox">
                    <div class="ibox-content">
                        <h2>
                            Data do povoamento:
                            <small> {{ pond.cycle.population.date }}</small>
                        </h2>
                        <h2>
                            Peso médio no povoamento:
                            <small> {{ pond.cycle.population.middleweight }} g</small>
                        </h2>
                        <h2>
                            Data estimada para despesca:
                            <small> {{ pond.cycle.date_despesca }}</small>
                        </h2>
                        <h2>
                            Peso médio esperado na despesca:
                            <small> {{ pond.cycle.middleweight_despesca }} g</small>
                        </h2>
                        <h2>
                            Biomassa:
                            <small> {{ pond.cycle.biomassa|floatformat:2 }} kg</small>
                        </h2>
                        <h2>
                            Peso Médio atual:
                            <small> {{ pond.cycle.peso_medio }} g</small>
                        </h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="ibox">
                    <div class="ibox-title">
                        <h3>Biometria</h3>
                        <div class="pull-right">
                            <a href="{% url 'biometria' property.id pond.id %}" class="btn btn-warning btn-outline btn-xs">Nova Biometria</a>
                        </div>
                    </div>
                    {% with all_biometria=pond.cycle.all_biometria  %}
                        {% if all_biometria|length > 0 %}
                        <div class="row">
                            <div class="col-lg-4">
                                <div class="ibox-content">
                                    <table class="footableB table table-stripped toggle-arrow-tiny" data-page-size="5">
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Peso medio</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        {% for bio in all_biometria %}
                                            <tr>
                                                <td>{{ bio.date }}</td>
                                                <td>{{ bio.middleweight }} g</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <td colspan="5">
                                                    <ul class="pagination pull-right"></ul>
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                            <div class="col-8 no-margins">
                                <div class="ibox-content">
                                    <div class="ibox-content">
                                        <div id="biometria-chart"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% else %}

                            <div class="ibox-content">
                                <h3>Nenhuma biometria realizada!</h3>
                            </div>

                        {% endif %}

                    {% endwith %}
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="ibox">
                    <div class="ibox-title">
                        <h3>Mortalidade</h3>
                        <div class="pull-right">
                            <a href="{% url 'mortality' property.id pond.id %}" class="btn btn-info btn-outline btn-xs">Novo registro</a>
                        </div>
                    </div>
                    {% with all_mortality=pond.cycle.all_mortality %}
                        {% if all_mortality|length > 0 %}
                        <div class="row">
                            <div class="col-lg-4 no-margins">
                                 <div class="ibox-content">

                                    <table class="footableM table table-stripped toggle-arrow-tiny" data-page-size="5">
                                        <thead>
                                        <tr>
                                            <th>Data</th>
                                            <th>Quantidade</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for mortality in all_mortality %}
                                            <tr>
                                                <td>{{ mortality.date }}</td>
                                                <td>{{ mortality.amount }} kg</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <td colspan="5">
                                                <ul class="pagination pull-right"></ul>
                                            </td>
                                        </tr>
                                        </tfoot>
                                    </table>

                                </div>
                            </div>
                            <div class="col-lg-8 no-margins">
                                <div class="ibox-content">
                                    <div class="ibox-content">
                                        <div id="mortality-chart"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {% else %}

                            <div class="ibox-content">
                                <h3>Nenhuma Mortalidade registrada!</h3>
                            </div>

                        {% endif %}

                    {% endwith %}
                </div>
            </div>
        </div>

    {% endif %}

{% endblock %}

{% block script %}

    <script src="{% static 'js/plugins/footable/footable.all.min.js' %}"></script>

    <script src="{% static 'js/plugins/morris/raphael-2.1.0.min.js' %}"></script>
    <script src="{% static 'js/plugins/morris/morris.js' %}"></script>

    <script src="{% static 'js/demo/morris-demo.js' %}"></script>

    <script>
        $(document).ready(function() {

            $('.footableB').footable();
            $('.footableM').footable();

            var months = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];

            $(function () {
                Morris.Line({
                    element: 'biometria-chart',
                    data: [
                        { day: '05', month: '01' , value: 100},
                        { day: '06', month: '01', value: 100},
                    ],
                    xkey: 'day',
                    ykeys: ['value'],
                    labels: ['2015', '2014'],
                    hideHover: 'auto',
                    resize: true,
                });

                Morris.Line({
                    element: 'mortality-chart',
                    data: [
                        { date: '8 de junho de 2019', value: 50.0 },
                        { date: '6 de junho de 2019', value: 20.0 },
                    ],
                    xkey: 'date',
                    ykeys: ['value'],
                    resize: true,
                    lineWidth:4,
                    labels: ['Value'],
                    lineColors: ['#1ab394'],
                    pointSize:5,
                })
            })

        });

    </script>

{% endblock %}